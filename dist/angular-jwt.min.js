angular.module("angular-jwt",["base64","angular-jwt.options","angular-jwt.interceptor","angular-jwt.jwt","angular-jwt.authManager"]),angular.module("angular-jwt.authManager",["base64"]).provider("authManager",function(){this.$get=["$rootScope","$injector","$location","jwtHelper","jwtInterceptor","jwtOptions",function(t,e,r,n,a,i){var o=i.getConfig();function u(t){return Array.isArray(t)?e.invoke(t,this,{options:null}):t()}function s(t){if(Array.isArray(t)||angular.isFunction(t))return e.invoke(t,o,{});throw new Error("unauthenticatedRedirector must be a function")}function h(){var t=u(o.tokenGetter);if(t)return!n.isTokenExpired(t)}t.isAuthenticated=!1;function c(){t.isAuthenticated=!0}function l(){t.isAuthenticated=!1}function d(){var e=u(o.tokenGetter);e&&(n.isTokenExpired(e)?t.$broadcast("tokenHasExpired",e):c())}if(e.has("$transitions"))e.get("$transitions").onStart({},function(t){var e=t.to(),r=t.router.stateService;if(e&&e.data&&!0===e.data.requiresLogin&&!h())return r.target(o.loginPath)});else{var f=e.has("$state")?"$stateChangeStart":"$routeChangeStart";t.$on(f,function(t,e){if(!e)return!1;var r=e.$$route?e.$$route:e.data;r&&!0===r.requiresLogin&&!h()&&(t.preventDefault(),s(o.unauthenticatedRedirector))})}return{authenticate:c,unauthenticate:l,getToken:function(){return u(o.tokenGetter)},redirect:function(){return s(o.unauthenticatedRedirector)},checkAuthOnRefresh:function(){e.has("$transitions")?e.get("$transitions").onStart({},d):t.$on("$locationChangeStart",d)},redirectWhenUnauthenticated:function(){t.$on("unauthenticated",function(){s(o.unauthenticatedRedirector),l()})},isAuthenticated:h}}]}),angular.module("angular-jwt.interceptor",["base64"]).provider("jwtInterceptor",function(){this.urlParam,this.authHeader,this.authPrefix,this.whiteListedDomains,this.tokenGetter;var t=this;this.$get=["$q","$injector","$rootScope","urlUtils","jwtOptions",function(e,r,n,a,i){var o=angular.extend({},i.getConfig(),t);return{request:function(t){if(t.skipAuthorization||!function(t){if(!a.isSameOrigin(t)&&!o.whiteListedDomains.length)throw new Error("As of v0.1.0, requests to domains other than the application's origin must be white listed. Use jwtOptionsProvider.config({ whiteListedDomains: [<domain>] }); to whitelist.");for(var e=a.urlResolve(t).hostname.toLowerCase(),r=0;r<o.whiteListedDomains.length;r++){var n=o.whiteListedDomains[r],i=n instanceof RegExp?n:new RegExp(n,"i");if(e.match(i))return!0}return!!a.isSameOrigin(t)}(t.url))return t;if(o.urlParam){if(t.params=t.params||{},t.params[o.urlParam])return t}else if(t.headers=t.headers||{},t.headers[o.authHeader])return t;return e.when(r.invoke(o.tokenGetter,this,{options:t})).then(function(e){return e&&(o.urlParam?t.params[o.urlParam]=e:t.headers[o.authHeader]=o.authPrefix+e),t})},responseError:function(t){return 401===t.status&&n.$broadcast("unauthenticated",t),e.reject(t)}}}]}),angular.module("angular-jwt.jwt",["base64"]).service("jwtHelper",["$window","$base64",function(t,e){this.urlBase64Decode=function(r){var n=r.replace(/-/g,"+").replace(/_/g,"/");switch(n.length%4){case 0:break;case 2:n+="==";break;case 3:n+="=";break;default:throw"Illegal base64url string!"}return t.decodeURIComponent(escape(e.decode(n)))},this.decodeToken=function(t){var e=t.split(".");if(3!==e.length)throw new Error("JWT must have 3 parts");var r=this.urlBase64Decode(e[1]);if(!r)throw new Error("Cannot decode the token");return angular.fromJson(r)},this.getTokenExpirationDate=function(t){var e=this.decodeToken(t);if(void 0===e.exp)return null;var r=new Date(0);return r.setUTCSeconds(e.exp),r},this.isTokenExpired=function(t,e){var r=this.getTokenExpirationDate(t);return e=e||0,null!==r&&!(r.valueOf()>(new Date).valueOf()+1e3*e)}}]),angular.module("angular-jwt.options",["base64"]).provider("jwtOptions",function(){var t={};this.config=function(e){t=e},this.$get=function(){var e={urlParam:null,authHeader:"Authorization",authPrefix:"Bearer ",whiteListedDomains:[],tokenGetter:function(){return null},loginPath:"/",unauthenticatedRedirectPath:"/",unauthenticatedRedirector:["$location",function(t){t.path(this.unauthenticatedRedirectPath)}]};function r(){this.config=angular.extend({},e,t)}return r.prototype.getConfig=function(){return this.config},new r}}),angular.module("angular-jwt.interceptor").service("urlUtils",function(){var t=document.createElement("a"),e=r(window.location.href);function r(e){var r=e;return t.setAttribute("href",r),r=t.href,t.setAttribute("href",r),{href:t.href,protocol:t.protocol?t.protocol.replace(/:$/,""):"",host:t.host,search:t.search?t.search.replace(/^\?/,""):"",hash:t.hash?t.hash.replace(/^#/,""):"",hostname:t.hostname,port:t.port,pathname:"/"===t.pathname.charAt(0)?t.pathname:"/"+t.pathname}}return{urlResolve:r,isSameOrigin:function(t){var n=angular.isString(t)?r(t):t;return n.protocol===e.protocol&&n.host===e.host}}});